{"remainingRequest":"E:\\黎超超\\an-express\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\黎超超\\an-express\\src\\components\\AvatarUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\黎超超\\an-express\\src\\components\\AvatarUpload.vue","mtime":1603936683956},{"path":"E:\\黎超超\\an-express\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyByZWYsIGNvbXB1dGVkLCBpbmplY3QgfSBmcm9tICJAdnVlL2NvbXBvc2l0aW9uLWFwaSI7DQppbXBvcnQgeyBpbWFnZURvbWFpbiB9IGZyb20gIkAvTWFpbkFQSS5qcyI7DQpleHBvcnQgZGVmYXVsdCB7DQogIHNldHVwKHByb3BzLCB7IHJvb3Q6IHsgJHN0b3JlLCAkbWVzc2FnZSB9IH0pIHsNCiAgICBjb25zdCBpbWFnZVVybCA9IHJlZigiIik7DQogICAgY29uc3QgaW1hZ2VEYXRhID0gcmVmKCIiKTsNCg0KICAgIC8vaW5qZWN0IHJlbG9hZCgpIHRvIHJlZnJlc2ggY29tcG9uZW50DQogICAgY29uc3QgdG9SZWxvYWQgPSBpbmplY3QoInJlbG9hZCIpOw0KDQogICAgY29uc3QgdmlzaWJsZSA9IGNvbXB1dGVkKCgpID0+IHsNCiAgICAgIHJldHVybiAkc3RvcmUuc3RhdGUuZGlhbG9nVmlzaWJsZTsNCiAgICB9KTsNCg0KICAgIGNvbnN0IHRva2VuID0gY29tcHV0ZWQoKCkgPT4gew0KICAgICAgcmV0dXJuICRzdG9yZS5zdGF0ZS50b2tlbjsNCiAgICB9KTsNCg0KICAgIC8vQmVmb3JlIHVwbG9hZGluZyBhdmF0YXIsIHZlcmlmeSB0aGUgZm9ybWF0IGFuZCBzaXplLg0KICAgIGNvbnN0IGJlZm9yZUF2YXRhclVwbG9hZCA9IChmaWxlKSA9PiB7DQogICAgICAkc3RvcmUuZGlzcGF0Y2goImdldFVwVG9rZW4iKQ0KICAgICAgbGV0IHNpZ24gPSB0cnVlOw0KICAgICAgY29uc3QgaW1nQWNjZXB0ID0gWyJpbWFnZS9naWYiLCAiaW1hZ2UvanBlZyIsICJpbWFnZS9qcGciLCAiaW1hZ2UvcG5nIl07DQogICAgICBjb25zdCBpc0x0MU0gPSBmaWxlLnNpemUgLyAxMDI0IC8gMTAyNCA8IDE7DQogICAgICBpZiAoaW1nQWNjZXB0LmluZGV4T2YoZmlsZS50eXBlKSA9PSAtMSkgew0KICAgICAgICAkbWVzc2FnZS5lcnJvcigi5paH5Lu25qC85byP5bqU5piv5Zu+54mH77yBIik7DQogICAgICAgIHNpZ24gPSBmYWxzZTsNCiAgICAgIH0gZWxzZSBpZiAoIWlzTHQxTSkgew0KICAgICAgICAkbWVzc2FnZS5lcnJvcigi5Zu+54mH5aSn5bCP6LaF6L+HMU1C5LqG77yBIik7DQogICAgICAgIHNpZ24gPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBzaWduOw0KICAgIH07DQogICAgLy9nZXRCYXNlNjQgaXMgdXNlZCB0byBjb252ZXJ0IGFuIGltYWdlIHRvIGJhc2U2NCBlbmNvZGVkIHN0cmluZw0KICAgIC8vIGNvbnN0IGdldEJhc2U2NCA9IChmaWxlKSA9PiB7DQogICAgLy8gICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgLy8gICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgIC8vICAgICBsZXQgaW1nUmVzdWx0ID0gIiI7DQogICAgLy8gICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOw0KICAgIC8vICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7DQogICAgLy8gICAgICAgaW1nUmVzdWx0ID0gcmVhZGVyLnJlc3VsdDsNCiAgICAvLyAgICAgfTsNCiAgICAvLyAgICAgcmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbihlcnJvcikgew0KICAgIC8vICAgICAgIHJlamVjdChlcnJvcik7DQogICAgLy8gICAgIH07DQogICAgLy8gICAgIHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHsNCiAgICAvLyAgICAgICByZXNvbHZlKGltZ1Jlc3VsdCk7DQogICAgLy8gICAgIH07DQogICAgLy8gICB9KTsNCiAgICAvLyB9Ow0KICAgIC8vZ2V0IHRoZSBpbWFnZSBieSB0aGUgaW1hZ2UgVVJMLCBhbmQgY29udmVydCBpdCB0byBlbmNvZGVkIHN0cmluZw0KICAgIGNvbnN0IGhhbmRsZUF2YXRhclN1Y2Nlc3MgPSAoZmlsZSkgPT4gew0KICAgICAgJHN0b3JlLmRpc3BhdGNoKCJnZXRVcFRva2VuIikudGhlbigoKSA9PiB7DQogICAgICAgIGltYWdlRGF0YS52YWx1ZSA9IGZpbGUua2V5Ow0KICAgICAgICBpbWFnZVVybC52YWx1ZSA9IGltYWdlRG9tYWluICsgZmlsZS5rZXk7DQogICAgICB9KTsNCiAgICAgIC8vIGltYWdlVXJsLnZhbHVlID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlLmZpbGUpOw0KICAgICAgLy8gZ2V0QmFzZTY0KGZpbGUuZmlsZSkudGhlbigocmVzKSA9PiB7DQogICAgICAvLyAgIGltYWdlRGF0YS52YWx1ZSA9IHJlczsNCiAgICAgIC8vIH0pOw0KICAgIH07DQogICAgLy9XaGVuIHN1Ym1pdC91cGRhdGUgYnV0dG9uIGlzIGNsaWNrZWQsIHNhdmUgdGhlIGltYWdlIGludG8gZGF0YWJhc2UNCiAgICBjb25zdCB1cGxvYWRBdmF0YXIgPSAoKSA9PiB7DQogICAgICBsZXQgZGF0YSA9IHsNCiAgICAgICAgYXZhdGFyOiBpbWFnZURhdGEudmFsdWUsDQogICAgICB9Ow0KICAgICAgJHN0b3JlDQogICAgICAgIC5kaXNwYXRjaCgiYXZhdGFyVXBsb2FkIiwgZGF0YSkNCiAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICRtZXNzYWdlLnN1Y2Nlc3MoIuWktOWDj+S4iuS8oOaIkOWKn++8gSIpOw0KICAgICAgICAgICRzdG9yZS5jb21taXQoIm9wZW5EaWFsb2ciLCBmYWxzZSk7DQogICAgICAgICAgdG9SZWxvYWQoKTsNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKCgpID0+IHt9KTsNCiAgICB9Ow0KICAgIC8vQ2xvc2UgdGhlIGRpYWxvZw0KICAgIGNvbnN0IGNsb3NlRGlhbG9nID0gKCkgPT4gew0KICAgICAgJHN0b3JlLmNvbW1pdCgib3BlbkRpYWxvZyIsIGZhbHNlKTsNCiAgICB9Ow0KICAgIHJldHVybiB7DQogICAgICBpbWFnZVVybCwNCiAgICAgIGJlZm9yZUF2YXRhclVwbG9hZCwNCiAgICAgIGhhbmRsZUF2YXRhclN1Y2Nlc3MsDQogICAgICB1cGxvYWRBdmF0YXIsDQogICAgICBjbG9zZURpYWxvZywNCg0KICAgICAgdmlzaWJsZSwNCg0KICAgICAgdG9rZW4sDQogICAgfTsNCiAgfSwNCn07DQo="},{"version":3,"sources":["AvatarUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA","file":"AvatarUpload.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <el-dialog\r\n    title=\"请更新头像\"\r\n    :visible.sync=\"visible\"\r\n    width=\"300px\"\r\n    :before-close=\"closeDialog\"\r\n  >\r\n    <el-upload\r\n      class=\"avatar-uploader\"\r\n      action=\"https://upload-z2.qiniup.com\"\r\n      :data=\"token\"\r\n      :on-success=\"handleAvatarSuccess\"\r\n      :before-upload=\"beforeAvatarUpload\"\r\n    >\r\n      <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\" />\r\n      <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n      <div class=\"el-upload__tip\" slot=\"tip\">\r\n        *上传照片只支持PNG，GIF，JPEG 和 JPG格式，大小不超过1MB。\r\n      </div>\r\n    </el-upload>\r\n    <span slot=\"footer\">\r\n      <el-button @click=\"closeDialog\">取消</el-button>\r\n      <el-button type=\"primary\" @click.enter=\"uploadAvatar\">确定</el-button>\r\n    </span>\r\n  </el-dialog>\r\n</template>\r\n<script>\r\nimport { ref, computed, inject } from \"@vue/composition-api\";\r\nimport { imageDomain } from \"@/MainAPI.js\";\r\nexport default {\r\n  setup(props, { root: { $store, $message } }) {\r\n    const imageUrl = ref(\"\");\r\n    const imageData = ref(\"\");\r\n\r\n    //inject reload() to refresh component\r\n    const toReload = inject(\"reload\");\r\n\r\n    const visible = computed(() => {\r\n      return $store.state.dialogVisible;\r\n    });\r\n\r\n    const token = computed(() => {\r\n      return $store.state.token;\r\n    });\r\n\r\n    //Before uploading avatar, verify the format and size.\r\n    const beforeAvatarUpload = (file) => {\r\n      $store.dispatch(\"getUpToken\")\r\n      let sign = true;\r\n      const imgAccept = [\"image/gif\", \"image/jpeg\", \"image/jpg\", \"image/png\"];\r\n      const isLt1M = file.size / 1024 / 1024 < 1;\r\n      if (imgAccept.indexOf(file.type) == -1) {\r\n        $message.error(\"文件格式应是图片！\");\r\n        sign = false;\r\n      } else if (!isLt1M) {\r\n        $message.error(\"图片大小超过1MB了！\");\r\n        sign = false;\r\n      }\r\n      return sign;\r\n    };\r\n    //getBase64 is used to convert an image to base64 encoded string\r\n    // const getBase64 = (file) => {\r\n    //   return new Promise(function(resolve, reject) {\r\n    //     let reader = new FileReader();\r\n    //     let imgResult = \"\";\r\n    //     reader.readAsDataURL(file);\r\n    //     reader.onload = function() {\r\n    //       imgResult = reader.result;\r\n    //     };\r\n    //     reader.onerror = function(error) {\r\n    //       reject(error);\r\n    //     };\r\n    //     reader.onloadend = function() {\r\n    //       resolve(imgResult);\r\n    //     };\r\n    //   });\r\n    // };\r\n    //get the image by the image URL, and convert it to encoded string\r\n    const handleAvatarSuccess = (file) => {\r\n      $store.dispatch(\"getUpToken\").then(() => {\r\n        imageData.value = file.key;\r\n        imageUrl.value = imageDomain + file.key;\r\n      });\r\n      // imageUrl.value = URL.createObjectURL(file.file);\r\n      // getBase64(file.file).then((res) => {\r\n      //   imageData.value = res;\r\n      // });\r\n    };\r\n    //When submit/update button is clicked, save the image into database\r\n    const uploadAvatar = () => {\r\n      let data = {\r\n        avatar: imageData.value,\r\n      };\r\n      $store\r\n        .dispatch(\"avatarUpload\", data)\r\n        .then(() => {\r\n          $message.success(\"头像上传成功！\");\r\n          $store.commit(\"openDialog\", false);\r\n          toReload();\r\n        })\r\n        .catch(() => {});\r\n    };\r\n    //Close the dialog\r\n    const closeDialog = () => {\r\n      $store.commit(\"openDialog\", false);\r\n    };\r\n    return {\r\n      imageUrl,\r\n      beforeAvatarUpload,\r\n      handleAvatarSuccess,\r\n      uploadAvatar,\r\n      closeDialog,\r\n\r\n      visible,\r\n\r\n      token,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.el-upload {\r\n  width: 100% !important;\r\n}\r\n.el-upload__input {\r\n  display: none !important;\r\n}\r\n.avatar-uploader {\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.avatar-uploader:hover {\r\n  border-color: #409eff;\r\n}\r\n.avatar-uploader-icon {\r\n  font-size: 80px;\r\n  margin-top: 30px;\r\n  margin-bottom: 70px;\r\n}\r\n.avatar {\r\n  width: 178px;\r\n  height: 178px;\r\n  display: block;\r\n  margin-left: 40px;\r\n}\r\n</style>\r\n"]}]}