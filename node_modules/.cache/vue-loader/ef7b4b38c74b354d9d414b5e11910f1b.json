{"remainingRequest":"E:\\黎超超\\an-express\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\黎超超\\an-express\\src\\views\\admin\\user\\UserAdvice.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"E:\\黎超超\\an-express\\src\\views\\admin\\user\\UserAdvice.vue","mtime":1603936683989},{"path":"E:\\黎超超\\an-express\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\黎超超\\an-express\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZWwtYnJlYWRjcnVtYi1vdXRlciB7DQogIGhlaWdodDogNDhweDsNCiAgZm9udC1zaXplOiAxNXB4Ow0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBmM2Y0Ow0KICBib3JkZXItcmFkaXVzOiAzcHg7DQp9DQoNCi5lbC11cGxvYWRfX2lucHV0IHsNCiAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Ow0KfQ0KLmVsLXVwbG9hZCB7DQogIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7DQp9DQouZWwtdXBsb2FkLWRyYWdnZXIgew0KICB3aWR0aDogMTAwJSAhaW1wb3J0YW50Ow0KfQ0KDQouZm9ybSB7DQogIG92ZXJmbG93OiBoaWRkZW47DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgd2lkdGg6IDYwJTsNCiAgbWFyZ2luOiBhdXRvOw0KICBsZWZ0OiAwOw0KICB0b3A6IDA7DQp9DQouaW5wdXQtd2lkdGggew0KICB3aWR0aDogY2FsYygxMDAlLTEwMHB4KTsNCn0NCi5wb2ludGVyIHsNCiAgY3Vyc29yOiBwb2ludGVyOw0KfQ0K"},{"version":3,"sources":["UserAdvice.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2aA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserAdvice.vue","sourceRoot":"src/views/admin/user","sourcesContent":["<template>\r\n  <div class=\"ml-4 mb-5\">\r\n    <div>\r\n      <el-breadcrumb\r\n        separator-class=\"el-icon-arrow-right\"\r\n        class=\"border el-breadcrumb-outer\"\r\n      >\r\n        <el-breadcrumb-item class=\"mt-3 ml-3\">投诉与建议</el-breadcrumb-item>\r\n         <el-button\r\n            v-if=\"addAdviceSign === false\"\r\n            type=\"primary\"\r\n            @click=\"switchAddAdvice\"\r\n            class=\"float-right mr-3\"\r\n            style=\"margin-top:5px;\"\r\n          >\r\n            填写建议\r\n            <i class=\"el-icon-warning fa-lg\"></i>\r\n          </el-button>\r\n      </el-breadcrumb>\r\n\r\n      <el-collapse-transition>\r\n        <div class=\"mt-5\" v-if=\"addAdviceSign === true\" v-loading=\"loading\">\r\n          <el-form\r\n            :model=\"ruleForm\"\r\n            :rules=\"rules\"\r\n            ref=\"ruleForm\"\r\n            label-position=\"left\"\r\n            label-width=\"100px\"\r\n            class=\"demo-ruleForm form\"\r\n          >\r\n            <el-form-item label=\"投诉类型\" prop=\"adviceType\">\r\n              <el-radio-group v-model=\"ruleForm.adviceType\">\r\n                <el-radio label=\"投诉\">投诉</el-radio>\r\n                <el-radio label=\"建议\">建议</el-radio>\r\n                <el-radio label=\"其他\">其他</el-radio>\r\n              </el-radio-group>\r\n            </el-form-item>\r\n            <el-form-item label=\"投诉标题\" prop=\"adviceTitle\">\r\n              <el-input\r\n                class=\"input-width\"\r\n                v-model=\"ruleForm.adviceTitle\"\r\n              ></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"投诉内容\" prop=\"adviceContent\">\r\n              <el-input\r\n                class=\"input-width\"\r\n                type=\"textarea\"\r\n                :autosize=\"{ minRows: 3 }\"\r\n                v-model=\"ruleForm.adviceContent\"\r\n              ></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"投诉照片\" prop=\"evidentPicture\">\r\n              <el-upload\r\n                drag\r\n                action=\"https://upload-z2.qiniup.com\"\r\n                :data=\"token\"\r\n                :on-remove=\"handleRemove\"\r\n                :on-success=\"handleAvatarSuccess\"\r\n                :before-upload=\"beforeAvatarUpload\"\r\n                list-type=\"picture\"\r\n              >\r\n                <i class=\"el-icon-upload\"></i>\r\n                <div class=\"el-upload__text\">\r\n                  拖拽照片 或者 <em>点击上传</em>\r\n                </div>\r\n                <div\r\n                  class=\"el-upload__tip text-danger\"\r\n                  style=\"font-size:14px;\"\r\n                  slot=\"tip\"\r\n                >\r\n                  <i class=\"fas fa-exclamation-circle mr-2\"></i\r\n                  >上传照片只支持PNG，GIF，JPEG 和\r\n                  JPG格式，大小不超过1MB。*每次只能上传一张图片\r\n                </div>\r\n              </el-upload>\r\n            </el-form-item>\r\n          </el-form>\r\n          <div style=\"width:100%;margin-bottom:20px;\">\r\n            <div\r\n              style=\"overflow: hidden;position:relative;margin: auto;left:0;top: 0;width:172px;\"\r\n            >\r\n              <el-button type=\"primary\" @click=\"addAdvice\">\r\n                上传\r\n              </el-button>\r\n              <el-button type=\"warning\" @click=\"switchAddAdvice\">\r\n                取消\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </el-collapse-transition>\r\n      <div class=\"mt-5\">\r\n        <el-table\r\n          :data=\"tableData\"\r\n          class=\"borderRadius\"\r\n          highlight-current-row\r\n          border\r\n          :default-sort=\"{ prop: 'adviceDate', order: 'descending' }\"\r\n        >\r\n          <el-table-column\r\n            fixed\r\n            prop=\"adviceDate\"\r\n            label=\"投诉时间\"\r\n            align=\"center\"\r\n            sortable\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <span>{{\r\n                row.adviceDate\r\n                  | moment(\"timezone\", \"Asia/Shanghai\", \"YYYY-MM-DD HH:mm:ss\")\r\n              }}</span>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            fixed\r\n            prop=\"adviceType\"\r\n            label=\"投诉类型\"\r\n            align=\"center\"\r\n            sortable\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <span class=\"text-danger\" v-if=\"row.adviceType === '投诉'\">投诉</span>\r\n              <span class=\"text-danger\" v-if=\"row.adviceType === '建议'\">建议</span>\r\n              <span class=\"text-danger\" v-if=\"row.adviceType === '其他'\">其他</span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column\r\n            prop=\"adviceTitle\"\r\n            label=\"投诉标题\"\r\n            align=\"center\"\r\n            sortable\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <span>{{ row.adviceTitle }}</span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column\r\n            prop=\"adviceContent\"\r\n            label=\"投诉详细内容\"\r\n            align=\"center\"\r\n            sortable\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <span>{{ row.adviceContent }}</span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column\r\n            prop=\"picture\"\r\n            label=\"证据照片\"\r\n            align=\"center\"\r\n            width=\"360\"\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <el-carousel v-if=\"row.picture.length > 1\" indicator-position=\"none\" height=\"150px\">\r\n                <el-carousel-item\r\n                  v-for=\"(object, index) in row.picture\"\r\n                  :key=\"index\"\r\n                >\r\n                  <img\r\n                    :src=\"object.src\"\r\n                    class=\"img-fluid pointer\"\r\n                    @click=\"showMultiple(row, index)\"\r\n                  />\r\n                </el-carousel-item>\r\n              </el-carousel>\r\n              <el-image\r\n                class=\"img-fluid\"\r\n                style=\"height:150px\"\r\n                v-else-if=\"row.picture.length === 1\"\r\n                :src=\"row.picture[0].src\"\r\n                :preview-src-list=\"[row.picture[0].src]\"\r\n                fit=\"cover\"\r\n              ></el-image>\r\n              <span v-else>暂无图片</span>\r\n              <vue-easy-lightbox\r\n                :visible=\"lightboxVisible\"\r\n                :imgs=\"img\"\r\n                :index=\"index\"\r\n                @hide=\"handleHide\"\r\n              ></vue-easy-lightbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            prop=\"adviceImprovement\"\r\n            label=\"改善办法\"\r\n            align=\"center\"\r\n            sortable\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <span class=\"text-success\" v-if=\"row.adviceImprovement\">{{\r\n                row.adviceImprovement\r\n              }}</span>\r\n              <span class=\"text-danger\" v-else>客服正在处理中 敬请期待</span>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n        <pagination\r\n          :data=\"tableData\"\r\n          class=\"mt-5 float-right\"\r\n          @pagechange=\"pageChange\"\r\n          pager=\"prev, pager, next, jumper, ->, total, slot\"\r\n          limitNumber=\"5\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  ref,\r\n  reactive,\r\n  inject,\r\n  onMounted,\r\n  computed,\r\n} from \"@vue/composition-api\";\r\nimport { imageDomain } from \"@/MainAPI.js\";\r\nimport pagination from \"../components/InfoPagination\";\r\n\r\nexport default {\r\n  components: {\r\n    pagination,\r\n  },\r\n  setup(props, { root: { $store, $message } }) {\r\n    onMounted(() => {\r\n      $store.dispatch(\"getUserAdvice\", {\r\n        page: \"0\",\r\n        size: \"5\",\r\n      });\r\n      $store.dispatch(\"getUpToken\");\r\n    });\r\n    const loading = ref(false);\r\n    const adviceList = computed(() => {\r\n      return $store.state.advicelist;\r\n    });\r\n\r\n    const toReload = inject(\"reload\");\r\n    const addAdviceSign = ref(false);\r\n\r\n    const imageUrl = ref([]);\r\n\r\n    const switchAddAdvice = () => {\r\n      addAdviceSign.value = !addAdviceSign.value;\r\n    };\r\n\r\n    const ruleForm = reactive({\r\n      adviceType: \"orderComplaint\",\r\n      adviceTitle: \"\",\r\n      adviceContent: \"\",\r\n      evidentPicture: [],\r\n    });\r\n\r\n    const addAdvice = () => {\r\n      let data = {\r\n        advice_type: ruleForm.adviceType,\r\n        advice_title: ruleForm.adviceTitle,\r\n        advice_content: ruleForm.adviceContent,\r\n        evident_image: ruleForm.evidentPicture,\r\n      };\r\n\r\n      if (data.advice_title === \"\") {\r\n        $message.error(\"请填写投诉信息的标题\");\r\n      } else if (data.advice_content === \"\") {\r\n        $message.error(\"请填写投诉信息的内容\");\r\n      } else if (data.evident_image.length === 0) {\r\n        $message.error(\"请上传货物的事故照片\");\r\n      } else {\r\n        loading.value = true;\r\n        $store\r\n          .dispatch(\"createAdvice\", data)\r\n          .then(() => {\r\n            $message.success(\"投诉提交成功！\");\r\n            loading.value = false;\r\n            toReload();\r\n          })\r\n          .catch(() => {\r\n            loading.value = false;\r\n          });\r\n      }\r\n    };\r\n\r\n    const tableData = computed(() => {\r\n      return adviceList.value.map((object) => {\r\n        return {\r\n          adviceDate: object.createdAt,\r\n          adviceType: object.advice_type,\r\n          picture: object.evident_image.map((object) => {\r\n            return {\r\n              src: imageDomain + object,\r\n            };\r\n          }),\r\n          // picture: [\r\n          //   {src:\"https://cdn.pixabay.com/photo/2020/03/31/07/56/face-mask-4986596_1280.jpg\"},\r\n          //   {src:\"https://cdn.pixabay.com/photo/2020/04/09/19/27/cherry-blossom-5022811_1280.jpg\"},\r\n          // ],\r\n          adviceTitle: object.advice_title,\r\n          adviceContent: object.advice_content,\r\n          adviceImprovement: object.advice_improvement,\r\n        };\r\n      });\r\n    });\r\n\r\n    const rules = reactive({\r\n      adviceType: [\r\n        { required: true, message: \"请输入投诉类型\", trigger: \"blur\" },\r\n      ],\r\n      adviceTitle: [\r\n        { required: true, message: \"请输入投诉标题\", trigger: \"blur\" },\r\n      ],\r\n      adviceContent: [\r\n        { required: true, message: \"请输入具体投诉内容\", trigger: \"blur\" },\r\n      ],\r\n      evidentPicture: [\r\n        { required: true, message: \"请选择问题照片\", trigger: \"blur\" },\r\n      ],\r\n    });\r\n\r\n    const token = computed(() => {\r\n      return $store.state.token;\r\n    });\r\n\r\n    //Before uploading pictures, verify the format and size.\r\n    const beforeAvatarUpload = (file) => {\r\n      let sign = true;\r\n      const imgAccept = [\"image/gif\", \"image/jpeg\", \"image/jpg\", \"image/png\"];\r\n      const isLt1M = file.size / 1024 / 1024 < 1;\r\n      if (imgAccept.indexOf(file.type) == -1) {\r\n        $message.error(\"上传文件应该是图片格式！\");\r\n        sign = false;\r\n      }\r\n      if (!isLt1M) {\r\n        $message.error(\"图片大小超过1MB了哦！\");\r\n        sign = false;\r\n      }\r\n      return sign;\r\n    };\r\n\r\n    //getBase64 is used to convert an image to base64 encoded string\r\n    // const getBase64 = (file) => {\r\n    //   return new Promise(function(resolve, reject) {\r\n    //     let reader = new FileReader();\r\n    //     let imgResult = \"\";\r\n    //     reader.readAsDataURL(file);\r\n    //     reader.onload = function() {\r\n    //       imgResult = reader.result;\r\n    //     };\r\n    //     reader.onerror = function(error) {\r\n    //       reject(error);\r\n    //     };\r\n    //     reader.onloadend = function() {\r\n    //       resolve(imgResult);\r\n    //     };\r\n    //   });\r\n    // };\r\n\r\n    //get the image by the image URL, and convert it to encoded string\r\n    // const handleAvatarSuccess = (file) => {\r\n    //   imageUrl.value = [URL.createObjectURL(file.file)];\r\n    //   getBase64(file.file).then((res) => {\r\n    //     ruleForm.evidentPicture = res;\r\n    //   });\r\n    // };\r\n    const handleRemove = (file) => {\r\n      let removeItemIndex = ruleForm.evidentPicture.indexOf(file.response.key);\r\n      ruleForm.evidentPicture.splice(removeItemIndex, 1);\r\n    };\r\n    const handleAvatarSuccess = (file) => {\r\n      $store.dispatch(\"getUpToken\").then(() => {\r\n        ruleForm.evidentPicture.push(file.key);\r\n        imageUrl.value.push(file.key);\r\n      });\r\n    };\r\n\r\n    const lightboxVisible = ref(false);\r\n    const index = ref(0);\r\n    const img = ref(\"\");\r\n    //close signle image's lightbox\r\n    const handleHide = () => {\r\n      lightboxVisible.value = false;\r\n    };\r\n    //show single image's lightbox\r\n    const showMultiple = (row, i) => {\r\n      lightboxVisible.value = true;\r\n      img.value = row.picture;\r\n      index.value = i;\r\n    };\r\n\r\n    const pageChange = (val) => {\r\n      $store.dispatch(\"getUserAdvice\", {\r\n        page: val - 1,\r\n        size: 5,\r\n      });\r\n    };\r\n\r\n    return {\r\n      loading,\r\n      addAdviceSign,\r\n      switchAddAdvice,\r\n      addAdvice,\r\n\r\n      tableData,\r\n      adviceList,\r\n      pageChange,\r\n\r\n      ruleForm,\r\n      rules,\r\n\r\n      imageUrl,\r\n      beforeAvatarUpload,\r\n      handleAvatarSuccess,\r\n      handleRemove,\r\n\r\n      lightboxVisible,\r\n      img,\r\n      index,\r\n      showMultiple,\r\n      handleHide,\r\n      token,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.el-breadcrumb-outer {\r\n  height: 48px;\r\n  font-size: 15px;\r\n  background-color: #f0f3f4;\r\n  border-radius: 3px;\r\n}\r\n\r\n.el-upload__input {\r\n  display: none !important;\r\n}\r\n.el-upload {\r\n  width: 100% !important;\r\n}\r\n.el-upload-dragger {\r\n  width: 100% !important;\r\n}\r\n\r\n.form {\r\n  overflow: hidden;\r\n  position: relative;\r\n  width: 60%;\r\n  margin: auto;\r\n  left: 0;\r\n  top: 0;\r\n}\r\n.input-width {\r\n  width: calc(100%-100px);\r\n}\r\n.pointer {\r\n  cursor: pointer;\r\n}\r\n</style>\r\n"]}]}